
@{
    ViewBag.Title = "Index";
}
<br /><br />

<p class="lead text-muted">Product Management Section</p>
<button type="button"
        onclick="PopupForm('@Url.Action("CreateOrUpdate","Product")')"
        class="btn btn-success glyphicon glyphicon-plus"></button>
<br /><br />
<table id="ProductTable" class="table table-bordered table-striped">
    <thead>
        <tr>
            <th>Name</th>
            <th>Description</th>
            <th>Price</th>
            <th>Category</th>
            <th>Actions</th>
        </tr>
    </thead>
</table>

@section Scripts{
<script type="text/javascript">
    var Popup, dataTables;

    $(document).ready(function () {
          dataTables = $("#ProductTable").DataTable({
              "ajax":
              {
                  "url": "/Product/ProductTable",
                  "datatype": "json",
                  "type": "GET"
              },
              "columns":
              [
                      { "data": "Name" }, { "data": "Description" },
                      { "data": "Price", "render": function (data) { return ("$" + data) }},
                  { "data": "Category.Name" },
                  {
                      "data": "ID",
                      "render": function (data) {
                          return "<a style='margin-right:5px;' class='btn btn-sm btn-warning glyphicon glyphicon-shopping-cart'></a>  <button data-id='" + data + "' class='btn btn-sm btn-info glyphicon glyphicon-pencil' onclick=UpdateProduct('@Url.Action("Edit", "Product")/" + data + "')  ></button> <button data-id='" + data + "' onclick='delprod("+data+")' class='btnDel btn btn-sm btn-danger glyphicon glyphicon-trash' ></button>";
                      }
                  }
              ],
              "language": { "ProductTbale": "No Data Found" }
          });
    });

    function PopupForm(url) {
         var formDiv = $("<div/>");
         $.get(url).done(function (response) {
             formDiv.html(response);
             Popup = formDiv.dialog({
                 autoOpen: true,
                 resizable: false,
                 title: 'Fill Product Details',
                 height: 490,
                 width: 850,
                 show: {
                     effect: "drop",
                     duration: 500
                 },
                 close: function () {
                     Popup.dialog('destroy').remove();
                 }
             });
         });
    }

    function SubmitForm(form) {
        console.log($(form).serialize());
            $.ajax({
                type: 'POST',
                url: form.action,
                data: $(form).serialize(),
                success: function (data) {
                    if (data.success) {
                        Popup.dialog("close");
                        dataTables.ajax.reload();
                    }
                }
            });
            return false;
        }

    function UpdateProduct(_url) {
            var formDiv=$("<div/>")
            $.ajax({
                type: 'GET',
                url: _url,
                data: {ID: $(this).attr('data-id')}
            }).done(function (data) {
                formDiv.html(data);
                Popup = formDiv.dialog({
                    autoOpen: true,
                    resizable: false,
                    title: 'Update Product Details',
                    height: 490,
                    width: 850,
                    show: {
                        effect: "drop",
                        duration: 500
                    },
                    close: function () {
                        Popup.dialog('destroy').remove();
                    }
                });
                console.log('Returned back from server', data);
            }).fail(function (XMLHttpRequest, txtStatus, errorThrown) { alert('Fail') });
        }

    function UpdateForm(form) {
            $.ajax({
                url: form.action,
                data: $(form).serialize(),
                type: 'POST',
                success: function (data) {
                    if (data.success) {
                        Popup.dialog("close");
                        dataTables.ajax.reload();
                    }
                }
            });
            return false;
        }

    function delprod(pid) {
            var _id = pid;
            bootbox.confirm('Are you sure you want to delete this product?', function (result) {
                if (result) {
                    $.ajax({
                        type: 'POST',
                        url: '/Product/Delete/' + _id,
                    }).done(function (res) {
                        if (res.success) {
                            dataTables.ajax.reload();
                        }
                    }).fail(function (XMLHttpRequest, txtStatus, errorThrown) { console.log('Fail') });
                }
            });
        }
</script>
}